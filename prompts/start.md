### üß† **Prompt for Code Agent: Design & Build a VSCode Plugin for Alfresco JS Console**

You're tasked with creating a **VSCode (or Cursor)** plugin that integrates with the **Alfresco JS Console**, allowing developers to write and run JavaScript scripts against an Alfresco repository directly from their IDE ‚Äî bypassing the web interface.

---

### üìå **Problem Statement**

Currently, developers must paste their Alfresco JS scripts into the web UI provided by Alfresco Share under `/alfresco/s/de/fme/jsconsole`. This interface lacks modern IDE features such as:

* Proper syntax highlighting
* Autocomplete or documentation lookup
* Version control
* Multi-window context (template + script)
* Live logs / multi-console output
* Parameter injection

Michel wants to **bring the JS Console experience into VSCode**, supporting streamlined scripting and *real-time streaming output* using the existing webscript endpoints. Additionally, he wants to extend the capabilities of the plugin by:

* Allowing parameter inputs (template, transaction, spaceNodeRef, etc.)
* Accessing post-execution results (`executionResult`)
* Supporting a custom output console for long streaming logs
* Treating each run as a session (with a unique resultChannel)
* Supporting multiple panels (e.g., "Debug Console", "Template Output", etc.)
* Letting users define multiple input panels: JS Script, FTL template, custom arguments

---

### üß© **Plugin Feature Set**

Design a plugin that supports the following:

#### üñãÔ∏è Script Authoring

* Language mode: JavaScript (with optional Java-backed types)
* Optional: Add FTL template support
* Syntax highlighting and snippets for Alfresco JS Console scripting

#### üõ∞Ô∏è Execution Mechanism

* `Run in Alfresco` button or shortcut

  * Sends current script via `POST` to:
    `https://<server>/alfresco/s/de/fme/jsconsole/execute`
  * Parameters included in the payload:

    * `script`, `template`, `spaceNodeRef`, `transaction`, `runas`, `urlargs`, `documentNodeRef`, `resultChannel` (autogenerated)
* Uses Basic Auth or external token input (safe vault store)

#### üì° Streaming Output

* Parse and display `printOutput` as it arrives (stdout-like console)
* Maintain streaming mode, parsing output in chunks while the script is running
* Result is displayed in a **custom console window**

  * Consider using VSCode‚Äôs **Output**, **Debug Console**, or **WebView Panel**

#### üì• Input Support

Allow users to input additional metadata:

* `FTL Template`
* `Transaction Type` (readonly/readwrite)
* `RunAs` identity
* `SpaceNodeRef`
* Custom arguments (JSON)

This can be achieved via a UI sidebar or settings form, per project or per script file.

#### üßæ Execution Results (Post)

* After streaming concludes, auto-request:

  * `GET /alfresco/s/de/fme/jsconsole/<resultChannel>/executionResult`
* Show final results and performance metrics:

  * `scriptPerf`, `webscriptPerf`, `spacePath`, etc.
* Optionally log to a persistent console or debug log

#### üß™ Advanced Features (Optional)

* Execute selected region only
* Save and replay past executions (history panel)
* Environment profiles (Dev, QA, Prod Alfresco endpoints)
* Multiple server configurations
* Integrate with Source Control: detect script changes

---

### üß≠ Plugin Structure (Suggested)

* **Sidebar Panel (WebView):**

  * Fields: Script, Template, Params, RunAs, Transaction
  * Button: Run in Alfresco
* **Output Channels:**

  * "Alfresco Console Output"
  * "Execution Result"
  * "FTL Rendered Output"
* **Custom Command Palette Commands:**

  * `Run Alfresco Script`
  * `Configure Alfresco Endpoint`
  * `Insert Template`
* **Configuration File** (e.g., `.alfresco-console.json`):

```json
{
  "server": "https://coordinador-dev.mintral.cl",
  "auth": {
    "username": "admin",
    "password": "secret"
  },
  "defaultTransaction": "readwrite",
  "runAs": "admin"
}
```

---

### üîß Example Flow

1. User opens `example.js` in VSCode
2. Inputs optional template or arguments via sidebar
3. Clicks `Run in Alfresco`
4. Plugin posts payload to JS Console endpoint
5. Plugin receives streaming output and displays in real-time
6. Plugin fetches and displays final execution result

---

### üß† Inspiration

You can take UX inspiration from:

* **Jupyter Notebooks in VSCode**
* **REST Client Plugin**
* **Chat-style agents with multi-part I/O (like Agent-LLM or Code Interpreter)**
* **Runme.dev (execute scripts in the terminal-like experience)**

---

### üõ†Ô∏è Implementation Considerations

* **Language**: TypeScript
* **Framework**: VSCode Extension API
* **Security**: Obfuscate and encrypt credentials, allow token-based auth
* **Streaming**: Use Node‚Äôs `https.request()` with chunked encoding and progressive output
* **Session Handling**: Maintain a channel ID (`resultChannel`) across both steps

---

### üß™ Sample Script Run Example

```javascript
const result = await executeScript({
  script: contentFromActiveEditor,
  template: optionalTemplate,
  resultChannel: Date.now().toString(),
  runas: "admin"
});

displayOutputStream(result.printOutput);
fetchFinalResult(result.resultChannel).then(showInOutput);
```
